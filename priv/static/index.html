<html>
    <head>
        <title>Tic Tac Toe</title>
        <style>
.control-panel {
    padding: 25px;
}

#status {
    padding: 25px;
}

table {
    border-collapse: collapse;
}

table, td {
    border: 1px solid black;
}

td {
    height: 50px;
    width: 50px;
}
        </style>
    </head>

    <body>
        <h1>Tic Tac Toe</h1>
        <div class="control-panel">
            <button id="new-game" disabled="true">New Game!</button>
        </div>
        <div id="status"></div>
        <div class="board">
            <table>
                <tr>
                    <td id="cell1" />
                    <td id="cell2" />
                    <td id="cell3" />
                </tr>
                <tr>
                    <td id="cell4" />
                    <td id="cell5" />
                    <td id="cell6" />
                </tr>
                <tr>
                    <td id="cell7" />
                    <td id="cell8" />
                    <td id="cell9" />
                </tr>
            </table>
        </div>
    </body>

    <script>
var sessionId, gameId;

var newGameBtn = document.getElementById('new-game');

var socket = new WebSocket('ws://localhost:8080/connect');

socket.onopen = function() {
    send('new_session');
};

socket.onmessage = function(ev) {
    console.log('Received data: ' + ev.data);
    var msg = JSON.parse(ev.data);
    if (msg.type === 'new_session') {
        sessionId = msg.id;
        newGameBtn.disabled = false;
    } else if (msg.type === 'new_game') {
        gameId = msg.id;
        updateStatus('New game!');
        clearBoard();
    } else if (msg.type === 'your_turn') {
        updateStatus('Your turn!');
        enableBoard();
    } else if (msg.type === 'wait') {
        updateStatus('Waiting for other player...');
    }
};

newGameBtn.onclick = function() {
    var msg = JSON.stringify({type: 'new_game', sessionId: sessionId});
    send(msg);
    newGameBtn.disabled = true;
    updateStatus('Waiting to join game...');
};

function clearBoard() {
    for (var i = 1; i < 10; i++) {
        document.getElementById('cell' + i).innerHTML = '';
    }
}

function updateStatus(status) {
    document.getElementById('status').innerHTML = status;
}

function send(msg) {
    console.log('Sent msg: ' + msg);
    socket.send(msg);
}

function enableBoard() {
    for (var i = 1; i < 10; i++) {
        document.getElementById('cell' + i).onclick = (function(id) {
            return function() {
                var msg = JSON.stringify({type: 'play', id: id})
                send(msg)
                disableBoard()
            }
        })(i)
    }
}

function disableBoard() {
    for (var i = 1; i < 10; i++) {
        document.getElementById('cell' + i).onclick = null
    }
}
    </script>
</html>
