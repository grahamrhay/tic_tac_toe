{erl_opts, [debug_info, {parse_transform, lager_transform}]}.

{deps, [
    {cowboy, {git, "https://github.com/ninenines/cowboy", {tag, "1.0.4"}}},
    {jsx, {git, "https://github.com/talentdeficit/jsx", {tag, "v2.8.0"}}},
    {uuid, {git, "https://github.com/avtobiff/erlang-uuid", {tag, "v0.5.0"}}},
    {gproc, {git, "https://github.com/uwiger/gproc.git", {branch, "master"}}},
    {lager, {git, "https://github.com/basho/lager.git", {tag, "2.1.0"}}},
    {exometer_core, {git, "git://github.com/basho/exometer_core.git", {branch, "th/correct-dependencies"}}},
    {riak_core, {git, "git://github.com/basho/riak_core", {branch, "develop"}}}
]}.

{relx, [{release, { tic_tac_toe, "0.1.0" },
         [tic_tac_toe,
          t3_web,
          t3_vnode,
          cuttlefish,
          sasl]},

        {sys_config, "./config/sys.config"},
        {vm_args, "./config/vm.args"},

        {dev_mode, true},
        {include_erts, false},

        {extended_start_script, true},

        {overlay_vars, "config/vars.config"},
        {overlay, [
            {mkdir, "etc"},
            {mkdir, "bin"},
            {mkdir, "data/ring"},
            {mkdir, "log/sasl"},
            {copy, "./config/admin_bin", "bin/tic_tac_toe-admin"},
            {template, "./config/advanced.config", "etc/advanced.config"}
        ]}]
}.

{project_plugins, [{rebar3_cuttlefish, {git, "git://github.com/tsloughter/rebar3_cuttlefish.git", {branch, "master"}}}]}.

{profiles, [{prod, [{relx, [{dev_mode, false},
                            {include_erts, true}]}]
            }]
}.

{overrides, [
    {override, eleveldb, [
        {artifacts, ["priv/eleveldb.so"]},
        {pre_hooks, [{compile, "c_src/build_deps.sh get-deps"},
        {compile, "c_src/build_deps.sh"}]},

        {post_hooks, [{clean, "c_src/build_deps.sh clean"}]},

        {plugins, [pc]},

        {provider_hooks, [{post,
                              [{compile, {pc, compile}},
                              {clean, {pc, clean}}
                              ]
                          }]
    }]},
    {override, riak_ensemble, [
        {artifacts, ["c_src/riak_ensemble_clock.o"]},
        {plugins, [pc]},
        {provider_hooks, [
            {post, [
                {compile, {pc, compile}},
                {clean, {pc, clean}}
            ]}
        ]},
        {erl_opts, [
            debug_info,
            warnings_as_errors,
            warn_untyped_record,
            nowarn_deprecated_function,
            {platform_define, "^[0-9]+", namespaced_types},
            {parse_transform, lager_transform}
        ]}
    ]},
    {override, riak_core, [
        {erl_opts, [
            warnings_as_errors,
            nowarn_deprecated_function,
            {parse_transform, lager_transform},
            debug_info,
            {platform_define, "^[0-9]+", namespaced_types},
            {platform_define, "^R15", "old_hash"}
        ]}
    ]}
]}.
